<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Bayyan - Evidence Extraction Manager</title>
    <link rel="icon" type="image/png" href="C:\Users\HP\Downloads\Blue and Gold 'Bayan' Logo Design (180 x 180 px).png">
    <style>
        body {
            margin: 0;
            padding: 0;
            font-family: Arial, sans-serif;
            background: #f5f5f5;
        }
        
        /* Landing Page Styles */
        .landing-page {
            min-height: 100vh;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }
        .landing-container {
            background: white;
            border-radius: 20px;
            padding: 60px 40px;
            box-shadow: 0 20px 40px rgba(0,0,0,0.1);
            text-align: center;
            max-width: 500px;
            width: 100%;
        }
        .landing-logo {
            font-size: 48px;
            margin-bottom: 20px;
            color: #667eea;
        }
        .landing-title {
            font-size: 32px;
            font-weight: bold;
            margin-bottom: 15px;
            color: #333;
        }
        .landing-subtitle {
            font-size: 18px;
            color: #666;
            margin-bottom: 40px;
            line-height: 1.6;
        }
        .google-login-btn {
            background: #4285f4;
            color: white;
            border: none;
            padding: 15px 30px;
            border-radius: 50px;
            font-size: 16px;
            font-weight: 500;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
            width: 100%;
            transition: all 0.3s ease;
            box-shadow: 0 4px 15px rgba(66, 133, 244, 0.3);
        }
        .google-login-btn:hover {
            background: #3367d6;
            transform: translateY(-2px);
            box-shadow: 0 6px 20px rgba(66, 133, 244, 0.4);
        }
        .loading-spinner {
            display: inline-block;
            width: 16px;
            height: 16px;
            border: 2px solid #ffffff;
            border-radius: 50%;
            border-top-color: transparent;
            animation: spin 1s ease-in-out infinite;
        }
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        /* App Styles */
        .app {
            display: flex;
            height: 100vh;
        }
        .pdf-section {
            flex: 2.5;
            padding: 5px;
            background: white;
            border-right: 1px solid #ddd;
            display: flex;
            flex-direction: column;
        }
        .sheet-section {
            flex: 1.5;
            padding: 20px;
            background: white;
            overflow-y: auto;
        }
        .tabs {
            display: flex;
            border-bottom: 1px solid #ddd;
            margin-bottom: 20px;
        }
        .tab {
            padding: 10px 20px;
            background: #f8f9fa;
            border: 1px solid #ddd;
            border-bottom: none;
            cursor: pointer;
            margin-right: 5px;
            border-radius: 4px 4px 0 0;
        }
        .tab.active {
            background: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
        }
        .tab-content {
            display: none;
        }
        .tab-content.active {
            display: block;
        }
        .pdf-viewer {
            flex: 1;
            height: calc(100vh - 100px);
            display: flex;
            flex-direction: column;
        }
        .pdf-viewer iframe {
            flex: 1;
            height: 100%;
        }
        .project-header {
            background: #f8f9fa;
            padding: 15px;
            border-bottom: 1px solid #dee2e6;
            margin-bottom: 20px;
        }
        .project-selector {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
        }
        .project-selector select {
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            min-width: 200px;
        }
        .papers-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 15px;
        }
        .papers-table th,
        .papers-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        .papers-table th {
            background: #f8f9fa;
            font-weight: bold;
        }
        .papers-table tr:nth-child(even) {
            background: #f9f9f9;
        }
        .upload-area {
            border: 2px dashed #ccc;
            padding: 40px;
            text-align: center;
            margin: 20px 0;
            border-radius: 8px;
        }
        .research-data {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            border-radius: 4px;
            padding: 15px;
            margin: 10px 0;
        }
        .data-field {
            margin: 15px 0;
        }
        .data-field label {
            font-weight: bold;
            display: block;
            margin-bottom: 8px;
            color: #333;
            font-size: 14px;
        }
        .data-field input, .data-field textarea {
            width: 100%;
            padding: 12px;
            border: 2px solid #e1e5e9;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.3s ease;
            box-sizing: border-box;
        }
        .data-field input:focus, .data-field textarea:focus {
            outline: none;
            border-color: #007bff;
            box-shadow: 0 0 0 3px rgba(0, 123, 255, 0.1);
        }
        .data-field textarea {
            min-height: 80px;
            resize: vertical;
        }
        button {
            background: #007bff;
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 4px;
            cursor: pointer;
            margin: 5px;
        }
        button:hover {
            background: #0056b3;
        }
        .add-paper-btn {
            background: #28a745;
            margin-bottom: 15px;
        }
        .export-excel-btn {
            background: #17a2b8;
        }
        .comments-section {
            margin-top: 10px;
            border-top: 1px solid #ddd;
            padding-top: 10px;
        }
        .comment {
            padding: 6px 10px;
            margin: 3px 0;
            border-radius: 4px;
            border-left: 4px solid;
        }
        .comment-red { background: #ffe6e6; border-left-color: #ff4444; }
        .comment-blue { background: #e6f3ff; border-left-color: #0066cc; }
        .comment-green { background: #e6ffe6; border-left-color: #00cc44; }
        .comment-yellow { background: #fffbe6; border-left-color: #ffcc00; }
        .comment-purple { background: #f0e6ff; border-left-color: #9933cc; }
        .color-picker {
            display: flex;
            gap: 3px;
            margin: 5px 0;
        }
        .color-btn {
            width: 25px;
            height: 25px;
            border: 2px solid #ddd;
            border-radius: 50%;
            cursor: pointer;
        }
        .color-btn.active {
            border-color: #333;
        }
        
        /* AI Summary Styles */
        .ai-summary-btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 25px;
            font-size: 14px;
            cursor: pointer;
            margin: 10px 0;
            transition: all 0.3s ease;
        }
        .ai-summary-btn:hover {
            transform: translateY(-1px);
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.4);
        }
        .ai-summary-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <!-- React and ReactDOM from CDN -->
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <!-- Babel for JSX transformation -->
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    
    <!-- Fixed Research Paper Data Extractor App -->
    <script type="text/babel">
        const { useState } = React;
        
        function LandingPage({ onLogin }) {
            const [isLoading, setIsLoading] = useState(false);
            
            function handleDemoLogin() {
                setIsLoading(true);
                setTimeout(() => {
                    onLogin({
                        name: 'Demo User',
                        email: 'demo@example.com',
                        picture: 'https://via.placeholder.com/40'
                    });
                    setIsLoading(false);
                }, 1000);
            }
            
            return (
                <div className="landing-page">
                    <div className="landing-container">
                        <div className="landing-logo">📚</div>
                        <h1 className="landing-title">Bayyan</h1>
                        <p className="landing-subtitle">
                            Advanced Research Paper Data Extraction & Analysis Platform
                        </p>
                        
                        <button 
                            className="google-login-btn" 
                            onClick={handleDemoLogin}
                            disabled={isLoading}
                            style={{ background: '#6c757d' }}
                        >
                            {isLoading ? (
                                <>
                                    <div className="loading-spinner"></div>
                                    Signing in...
                                </>
                            ) : (
                                <>
                                    🚀 Try Demo
                                </>
                            )}
                        </button>
                        
                        <div style={{ marginTop: '30px', fontSize: '14px', color: '#666' }}>
                            <p>✨ AI-powered PDF analysis</p>
                            <p>📊 Smart data extraction</p>
                            <p>🔍 Advanced search & filtering</p>
                            <p>📈 Export to multiple formats</p>
                        </div>
                    </div>
                </div>
            );
        }
        
        function PDFReader({ onTextSelect, selectedText, onSummaryGenerated }) {
            const [pdfUrl, setPdfUrl] = useState(null);
            const [pdfFile, setPdfFile] = useState(null);
            const [isGeneratingSummary, setIsGeneratingSummary] = useState(false);
            
            function handleFileUpload(e) {
                const file = e.target.files[0];
                if (file && file.type === "application/pdf") {
                    setPdfFile(file);
                    setPdfUrl(URL.createObjectURL(file));
                }
            }
            
            async function generateAISummary() {
                if (!pdfFile) {
                    alert("Please upload a PDF first!");
                    return;
                }
                
                setIsGeneratingSummary(true);
                
                try {
                    // Simulate AI summary generation
                    setTimeout(() => {
                        const mockSummary = {
                            title: "AI-Generated Research Summary",
                            authors: "Extracted from PDF",
                            "author contact": "contact@research.org",
                            citation: "AI Generated et al. (2024)",
                            "study type": "Research Study",
                            "country setting": "Various",
                            "population description": "Study participants as described in the paper",
                            "aims objectives": "Primary research objectives and goals",
                            outcomes: "Key outcomes and findings",
                            randomNumber: Math.floor(Math.random() * 10000) + 1000,
                            pico: "Population, Intervention, Comparison, Outcomes framework",
                            summaryabstract: "Comprehensive summary of the research paper including methodology, results, and conclusions",
                            keywords: "Key terms and concepts from the paper",
                            methodology: "Research design and methods used",
                            results: "Main findings and statistical results",
                            conclusions: "Study conclusions and implications",
                            references: "Key references from the paper",
                            publicationDate: "2024",
                            journal: "Research Journal",
                            notes: "Additional insights and observations"
                        };
                        
                        onSummaryGenerated(mockSummary);
                        setIsGeneratingSummary(false);
                        alert("AI summary generated! Check the form fields.");
                    }, 3000);
                    
                } catch (error) {
                    console.error("Error generating summary:", error);
                    alert("Error generating summary. Please try again.");
                    setIsGeneratingSummary(false);
                }
            }
            
            function handleMouseUp() {
                const sel = window.getSelection();
                if (sel && sel.toString().trim()) {
                    onTextSelect(sel.toString());
                }
            }
            
            return (
                <div style={{ padding: "10px" }}>
                    <input 
                        type="file" 
                        accept="application/pdf" 
                        onChange={handleFileUpload}
                        style={{ margin: "10px 0" }}
                    />
                    
                    {pdfFile && (
                        <button 
                            className="ai-summary-btn"
                            onClick={generateAISummary}
                            disabled={isGeneratingSummary}
                        >
                            {isGeneratingSummary ? (
                                <>
                                    <div className="loading-spinner"></div>
                                    Generating AI Summary...
                                </>
                            ) : (
                                <>
                                    🤖 Generate AI Summary
                                </>
                            )}
                        </button>
                    )}
                    
                    <div className="pdf-viewer">
                        {pdfUrl ? (
                            <iframe
                                src={pdfUrl}
                                style={{
                                    width: "100%",
                                    height: "100%",
                                    border: "none",
                                    borderRadius: "0px"
                                }}
                                title="PDF Viewer"
                                onMouseUp={handleMouseUp}
                            />
                        ) : (
                            <div className="upload-area">
                                <p>Upload a research paper PDF to view and annotate</p>
                            </div>
                        )}
                    </div>
                    
                    {selectedText && (
                        <div style={{ 
                            marginTop: "10px", 
                            padding: "8px", 
                            background: "#e3f2fd", 
                            borderRadius: "4px",
                            border: "1px solid #2196f3"
                        }}>
                            <strong>Selected Text:</strong> "{selectedText}"
                        </div>
                    )}
                </div>
            );
        }
        
        function ResearchDataExtractor({ selectedText, onSummaryGenerated }) {
            const [projects, setProjects] = useState([
                { id: 1, name: "Literature Review 2024", papers: [] }
            ]);
            const [currentProject, setCurrentProject] = useState(1);
            const [currentPaper, setCurrentPaper] = useState({
                title: "",
                authors: "",
                "author contact": "",
                citation: "",
                "study type": "",
                "country setting": "",
                "population description": "",
                "aims objectives": "",
                outcomes: "",
                randomNumber: "",
                pico: "",
                summaryabstract: "",
                keywords: "",
                methodology: "",
                results: "",
                conclusions: "",
                references: "",
                publicationDate: "",
                journal: "",
                notes: ""
            });
            const [editingPaperIndex, setEditingPaperIndex] = useState(-1);
            const [comments, setComments] = useState([]);
            const [commentText, setCommentText] = useState("");
            const [selectedColor, setSelectedColor] = useState("red");
            const [activeTab, setActiveTab] = useState("papers");
            const [customFields, setCustomFields] = useState([]);
            const [newFieldName, setNewFieldName] = useState("");
            
            const colors = [
                { name: "red", class: "comment-red" },
                { name: "blue", class: "comment-blue" },
                { name: "green", class: "comment-green" },
                { name: "yellow", class: "comment-yellow" },
                { name: "purple", class: "comment-purple" }
            ];
            
            function createNewProject() {
                const projectName = prompt("Enter project name:");
                if (projectName) {
                    const newProject = {
                        id: Date.now(),
                        name: projectName,
                        papers: []
                    };
                    setProjects(prev => [...prev, newProject]);
                    setCurrentProject(newProject.id);
                }
            }
            
            function updateField(field, value) {
                setCurrentPaper(prev => ({
                    ...prev,
                    [field]: value
                }));
            }
            
            function addCustomField() {
                if (newFieldName.trim() && !customFields.includes(newFieldName.trim())) {
                    setCustomFields(prev => [...prev, newFieldName.trim()]);
                    setCurrentPaper(prev => ({
                        ...prev,
                        [newFieldName.trim()]: ""
                    }));
                    setNewFieldName("");
                }
            }
            
            function removeCustomField(fieldName) {
                setCustomFields(prev => prev.filter(field => field !== fieldName));
                setCurrentPaper(prev => {
                    const newPaper = { ...prev };
                    delete newPaper[fieldName];
                    return newPaper;
                });
            }
            
            function handleSummaryGenerated(summary) {
                setCurrentPaper(prev => ({
                    ...prev,
                    ...summary
                }));
            }
            
            function generateRandomNumber() {
                const randomNum = Math.floor(Math.random() * 10000) + 1000;
                setCurrentPaper(prev => ({
                    ...prev,
                    randomNumber: randomNum.toString()
                }));
            }
            
            function addPaperToProject() {
                if (currentPaper.title.trim()) {
                    const project = projects.find(p => p.id === currentProject);
                    if (project) {
                        const updatedProjects = projects.map(p => 
                            p.id === currentProject 
                                ? { ...p, papers: [...p.papers, { ...currentPaper, id: Date.now() }] }
                                : p
                        );
                        setProjects(updatedProjects);
                        setCurrentPaper({
                            title: "",
                            authors: "",
                            "author contact": "",
                            citation: "",
                            "study type": "",
                            "country setting": "",
                            "population description": "",
                            "aims objectives": "",
                            outcomes: "",
                            randomNumber: "",
                            pico: "",
                            summaryabstract: "",
                            keywords: "",
                            methodology: "",
                            results: "",
                            conclusions: "",
                            references: "",
                            publicationDate: "",
                            journal: "",
                            notes: "",
                            ...Object.fromEntries(customFields.map(field => [field, ""]))
                        });
                    }
                }
            }
            
            function editPaper(paperIndex) {
                const project = projects.find(p => p.id === currentProject);
                if (project && project.papers[paperIndex]) {
                    setCurrentPaper({ ...project.papers[paperIndex] });
                    setEditingPaperIndex(paperIndex);
                }
            }
            
            function updatePaper() {
                if (editingPaperIndex >= 0 && currentPaper.title.trim()) {
                    const updatedProjects = projects.map(p => 
                        p.id === currentProject 
                            ? { 
                                ...p, 
                                papers: p.papers.map((paper, index) => 
                                    index === editingPaperIndex ? { ...currentPaper, id: paper.id } : paper
                                )
                            }
                            : p
                    );
                    setProjects(updatedProjects);
                    setCurrentPaper({
                        title: "",
                        authors: "",
                        "author contact": "",
                        citation: "",
                        "study type": "",
                        "country setting": "",
                        "population description": "",
                        "aims objectives": "",
                        outcomes: "",
                        randomNumber: "",
                        pico: "",
                        summaryabstract: "",
                        keywords: "",
                        methodology: "",
                        results: "",
                        conclusions: "",
                        references: "",
                        publicationDate: "",
                        journal: "",
                        notes: "",
                        ...Object.fromEntries(customFields.map(field => [field, ""]))
                    });
                    setEditingPaperIndex(-1);
                }
            }
            
            function deletePaper(paperIndex) {
                if (confirm("Are you sure you want to delete this paper?")) {
                    const updatedProjects = projects.map(p => 
                        p.id === currentProject 
                            ? { ...p, papers: p.papers.filter((_, index) => index !== paperIndex) }
                            : p
                    );
                    setProjects(updatedProjects);
                }
            }
            
            function addComment() {
                if (commentText.trim()) {
                    const newComment = {
                        id: Date.now(),
                        text: commentText,
                        color: selectedColor,
                        selectedText: selectedText,
                        timestamp: new Date().toLocaleString()
                    };
                    setComments([...comments, newComment]);
                    setCommentText("");
                }
            }
            
            function exportToExcel() {
                const project = projects.find(p => p.id === currentProject);
                if (!project || project.papers.length === 0) {
                    alert("No papers to export!");
                    return;
                }
                
                // Create CSV content
                const headers = Object.keys(project.papers[0]).filter(key => key !== 'id');
                const csvContent = [
                    headers.join(','),
                    ...project.papers.map(paper => 
                        headers.map(header => {
                            const value = paper[header] || '';
                            // Escape quotes and wrap in quotes if contains comma
                            return value.includes(',') ? `"${value.replace(/"/g, '""')}"` : value;
                        }).join(',')
                    )
                ].join('\n');
                
                // Download CSV file
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `${project.name.replace(/[^a-z0-9]/gi, '_')}.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            function exportProjectAsExcel() {
                const project = projects.find(p => p.id === currentProject);
                if (!project) {
                    alert("No project to export!");
                    return;
                }
                
                // Create comprehensive Excel content with papers and comments
                let csvContent = "Project: " + project.name + "\n\n";
                
                // Papers section
                if (project.papers.length > 0) {
                    csvContent += "PAPERS:\n";
                    const paperHeaders = Object.keys(project.papers[0]).filter(key => key !== 'id');
                    csvContent += paperHeaders.join(',') + "\n";
                    csvContent += project.papers.map(paper => 
                        paperHeaders.map(header => {
                            const value = paper[header] || '';
                            return value.includes(',') ? `"${value.replace(/"/g, '""')}"` : value;
                        }).join(',')
                    ).join('\n');
                }
                
                // Comments section
                if (comments.length > 0) {
                    csvContent += "\n\nCOMMENTS:\n";
                    csvContent += "Timestamp,Color,Selected Text,Comment\n";
                    csvContent += comments.map(comment => 
                        `"${comment.timestamp}","${comment.color}","${comment.selectedText.replace(/"/g, '""')}","${comment.text.replace(/"/g, '""')}"`
                    ).join('\n');
                }
                
                // Download comprehensive Excel file
                const blob = new Blob([csvContent], { type: 'text/csv;charset=utf-8;' });
                const link = document.createElement('a');
                const url = URL.createObjectURL(blob);
                link.setAttribute('href', url);
                link.setAttribute('download', `${project.name.replace(/[^a-z0-9]/gi, '_')}_Complete_Project.csv`);
                link.style.visibility = 'hidden';
                document.body.appendChild(link);
                link.click();
                document.body.removeChild(link);
            }
            
            const currentProjectData = projects.find(p => p.id === currentProject);
            
            return (
                <div>
                    <div className="project-header">
                        <h2>Research Project Manager</h2>
                        <div className="project-selector">
                            <label>Current Project:</label>
                            <select 
                                value={currentProject} 
                                onChange={(e) => setCurrentProject(Number(e.target.value))}
                            >
                                {projects.map(project => (
                                    <option key={project.id} value={project.id}>
                                        {project.name} ({project.papers.length} papers)
                                    </option>
                                ))}
                            </select>
                            <button onClick={createNewProject}>New Project</button>
                        </div>
                    </div>
                    
                    <div className="tabs">
                        <div 
                            className={`tab ${activeTab === "papers" ? "active" : ""}`}
                            onClick={() => setActiveTab("papers")}
                        >
                            📄 Papers
                        </div>
                        <div 
                            className={`tab ${activeTab === "comments" ? "active" : ""}`}
                            onClick={() => setActiveTab("comments")}
                        >
                            💬 Comments ({comments.length})
                        </div>
                        <div 
                            className={`tab ${activeTab === "export" ? "active" : ""}`}
                            onClick={() => setActiveTab("export")}
                        >
                            📊 Export
                        </div>
                    </div>
                    
                    <div className={`tab-content ${activeTab === "papers" ? "active" : ""}`}>
                        <div className="research-data">
                            <h3>{editingPaperIndex >= 0 ? 'Edit Paper' : 'Add New Paper'}</h3>
                            
                            {/* Add Custom Field Section */}
                            <div style={{ marginBottom: "20px", padding: "10px", background: "#e9ecef", borderRadius: "4px" }}>
                                <h4 style={{ margin: "0 0 10px 0" }}>Add Custom Field</h4>
                                <div style={{ display: "flex", gap: "8px", alignItems: "center" }}>
                                    <input
                                        type="text"
                                        value={newFieldName}
                                        onChange={(e) => setNewFieldName(e.target.value)}
                                        placeholder="Enter field name..."
                                        style={{ flex: 1, padding: "6px", border: "1px solid #ddd", borderRadius: "4px" }}
                                        onKeyPress={(e) => e.key === 'Enter' && addCustomField()}
                                    />
                                    <button onClick={addCustomField} style={{ padding: "6px 12px", fontSize: "12px" }}>
                                        Add Field
                                    </button>
                                </div>
                            </div>
                            
                            {/* Random Number Generator */}
                            <div style={{ marginBottom: "15px", padding: "10px", background: "#e3f2fd", borderRadius: "4px" }}>
                                <div style={{ display: "flex", alignItems: "center", gap: "10px" }}>
                                    <label style={{ margin: 0, fontWeight: "bold" }}>Random Number:</label>
                                    <input
                                        type="text"
                                        value={currentPaper.randomNumber}
                                        readOnly
                                        style={{ 
                                            padding: "6px", 
                                            border: "1px solid #ddd", 
                                            borderRadius: "4px",
                                            background: "#f8f9fa",
                                            width: "100px"
                                        }}
                                    />
                                    <button onClick={generateRandomNumber} style={{ padding: "6px 12px", fontSize: "12px" }}>
                                        Generate
                                    </button>
                                </div>
                            </div>
                            
                            {/* Standard Fields */}
                            {Object.entries(currentPaper).filter(([key]) => key !== 'id' && key !== 'randomNumber' && !customFields.includes(key)).map(([field, value]) => {
                                const isLongField = ['summaryabstract', 'pico', 'methodology', 'results', 'conclusions', 'notes', 'population description', 'aims objectives'].includes(field);
                                
                                return (
                                    <div key={field} className="data-field">
                                        <label>{field.charAt(0).toUpperCase() + field.slice(1)}:</label>
                                        {isLongField ? (
                                            <textarea
                                                value={value}
                                                onChange={(e) => updateField(field, e.target.value)}
                                                placeholder={`Enter ${field}...`}
                                            />
                                        ) : (
                                            <input
                                                type="text"
                                                value={value}
                                                onChange={(e) => updateField(field, e.target.value)}
                                                placeholder={`Enter ${field}...`}
                                            />
                                        )}
                                    </div>
                                );
                            })}
                            
                            {/* Custom Fields */}
                            {customFields.map(field => (
                                <div key={field} className="data-field" style={{ position: "relative" }}>
                                    <label>{field.charAt(0).toUpperCase() + field.slice(1)}:</label>
                                    <textarea
                                        value={currentPaper[field] || ""}
                                        onChange={(e) => updateField(field, e.target.value)}
                                        placeholder={`Enter ${field}...`}
                                    />
                                    <button
                                        onClick={() => removeCustomField(field)}
                                        style={{
                                            position: "absolute",
                                            right: "-30px",
                                            top: "20px",
                                            padding: "2px 6px",
                                            fontSize: "10px",
                                            background: "#dc3545",
                                            border: "none",
                                            borderRadius: "3px",
                                            color: "white",
                                            cursor: "pointer"
                                        }}
                                        title="Remove field"
                                    >
                                        ×
                                    </button>
                                </div>
                            ))}
                            
                            <div style={{ marginTop: "15px" }}>
                                {editingPaperIndex >= 0 ? (
                                    <>
                                        <button onClick={updatePaper} style={{ marginRight: "10px" }}>
                                            Update Paper
                                        </button>
                                        <button onClick={() => {
                                            setCurrentPaper({
                                                title: "",
                                                authors: "",
                                                "author contact": "",
                                                citation: "",
                                                "study type": "",
                                                "country setting": "",
                                                "population description": "",
                                                "aims objectives": "",
                                                outcomes: "",
                                                randomNumber: "",
                                                pico: "",
                                                summaryabstract: "",
                                                keywords: "",
                                                methodology: "",
                                                results: "",
                                                conclusions: "",
                                                references: "",
                                                publicationDate: "",
                                                journal: "",
                                                notes: "",
                                                ...Object.fromEntries(customFields.map(field => [field, ""]))
                                            });
                                            setEditingPaperIndex(-1);
                                        }}>
                                            Cancel Edit
                                        </button>
                                    </>
                                ) : (
                                    <button onClick={addPaperToProject} className="add-paper-btn">
                                        Add Paper to Project
                                    </button>
                                )}
                            </div>
                        </div>
                        
                        {currentProjectData && currentProjectData.papers.length > 0 && (
                            <div style={{ marginTop: "20px" }}>
                                <h3>Papers in Project: {currentProjectData.name}</h3>
                                <table className="papers-table">
                                    <thead>
                                        <tr>
                                            <th>Title</th>
                                            <th>Authors</th>
                                            <th>Journal</th>
                                            <th>Year</th>
                                            <th>Actions</th>
                                        </tr>
                                    </thead>
                                    <tbody>
                                        {currentProjectData.papers.map((paper, index) => (
                                            <tr key={paper.id}>
                                                <td>{paper.title}</td>
                                                <td>{paper.authors}</td>
                                                <td>{paper.journal}</td>
                                                <td>{paper.publicationDate}</td>
                                                <td>
                                                    <button 
                                                        onClick={() => editPaper(index)}
                                                        style={{ marginRight: "5px", padding: "4px 8px", fontSize: "12px" }}
                                                    >
                                                        Edit
                                                    </button>
                                                    <button 
                                                        onClick={() => deletePaper(index)}
                                                        style={{ padding: "4px 8px", fontSize: "12px", background: "#dc3545" }}
                                                    >
                                                        Delete
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        )}
                    </div>
                    
                    <div className={`tab-content ${activeTab === "comments" ? "active" : ""}`}>
                        <div className="comments-section">
                            <h3>Annotations & Comments</h3>
                            {selectedText && (
                                <div style={{ marginBottom: "5px", padding: "6px", background: "#f0f0f0", borderRadius: "4px" }}>
                                    <strong>Selected Text:</strong> "{selectedText}"
                                </div>
                            )}
                            
                            <div className="color-picker">
                                {colors.map(color => (
                                    <div
                                        key={color.name}
                                        className={`color-btn ${selectedColor === color.name ? 'active' : ''}`}
                                        style={{ backgroundColor: color.name }}
                                        onClick={() => setSelectedColor(color.name)}
                                        title={color.name}
                                    />
                                ))}
                            </div>
                            
                            <div style={{ display: "flex", gap: "8px", marginBottom: "8px" }}>
                                <input
                                    type="text"
                                    placeholder="Add a comment..."
                                    value={commentText}
                                    onChange={(e) => setCommentText(e.target.value)}
                                    style={{ flex: 1, padding: "6px", border: "1px solid #ddd", borderRadius: "4px" }}
                                    onKeyPress={(e) => e.key === 'Enter' && addComment()}
                                />
                                <button onClick={addComment}>Add Comment</button>
                            </div>
                            
                            <div>
                                {comments.map(comment => (
                                    <div key={comment.id} className={`comment comment-${comment.color}`}>
                                        <div><strong>{comment.timestamp}</strong></div>
                                        {comment.selectedText && (
                                            <div style={{ fontStyle: "italic", marginBottom: "3px" }}>
                                                "{comment.selectedText}"
                                            </div>
                                        )}
                                        <div>{comment.text}</div>
                                    </div>
                                ))}
                            </div>
                        </div>
                    </div>
                    
                    <div className={`tab-content ${activeTab === "export" ? "active" : ""}`}>
                        <div style={{ padding: "20px", background: "#f8f9fa", borderRadius: "8px" }}>
                            <h3>Export Options</h3>
                            <p>Export your research data and annotations in various formats.</p>
                            
                            <div style={{ marginTop: "20px" }}>
                                <button 
                                    onClick={exportToExcel} 
                                    className="export-excel-btn" 
                                    style={{ 
                                        marginRight: "10px", 
                                        padding: "12px 20px",
                                        fontSize: "16px"
                                    }}
                                >
                                    📄 Export Papers Only
                                </button>
                                <button 
                                    onClick={exportProjectAsExcel} 
                                    style={{ 
                                        background: "#6f42c1", 
                                        padding: "12px 20px",
                                        fontSize: "16px"
                                    }}
                                >
                                    📊 Export Complete Project
                                </button>
                            </div>
                            
                            <div style={{ marginTop: "20px", padding: "15px", background: "white", borderRadius: "4px" }}>
                                <h4>Export Summary:</h4>
                                <ul>
                                    <li><strong>Papers:</strong> {currentProjectData ? currentProjectData.papers.length : 0} papers</li>
                                    <li><strong>Comments:</strong> {comments.length} annotations</li>
                                    <li><strong>Project:</strong> {currentProjectData ? currentProjectData.name : "None"}</li>
                                </ul>
                            </div>
                        </div>
                    </div>
                </div>
            );
        }
        
        function App() {
            const [selectedText, setSelectedText] = useState("");
            const [user, setUser] = useState(null);
            
            function handleLogin(userData) {
                setUser(userData);
            }
            
            function handleSummaryGenerated(summary) {
                // This will be handled by the ResearchDataExtractor component
            }
            
            if (!user) {
                return <LandingPage onLogin={handleLogin} />;
            }
            
            return (
                <div className="app">
                    <div className="pdf-section">
                        <div style={{ 
                            padding: "10px", 
                            background: "#f8f9fa", 
                            borderBottom: "1px solid #ddd",
                            display: "flex",
                            justifyContent: "space-between",
                            alignItems: "center"
                        }}>
                            <h2 style={{ margin: 0 }}>Research Paper PDF Reader</h2>
                            <div style={{ display: "flex", alignItems: "center", gap: "10px" }}>
                                <span>Welcome, {user.name}!</span>
                                <img 
                                    src={user.picture} 
                                    alt="Profile" 
                                    style={{ 
                                        width: "32px", 
                                        height: "32px", 
                                        borderRadius: "50%",
                                        border: "2px solid #ddd"
                                    }}
                                />
                                <button 
                                    onClick={() => setUser(null)}
                                    style={{ 
                                        padding: "5px 10px", 
                                        fontSize: "12px",
                                        background: "#dc3545"
                                    }}
                                >
                                    Logout
                                </button>
                            </div>
                        </div>
                        <PDFReader 
                            onTextSelect={setSelectedText} 
                            selectedText={selectedText}
                            onSummaryGenerated={handleSummaryGenerated}
                        />
                    </div>
                    <div className="sheet-section">
                        <ResearchDataExtractor 
                            selectedText={selectedText}
                            onSummaryGenerated={handleSummaryGenerated}
                        />
                    </div>
                </div>
            );
        }
        
        // Render the app
        try {
            const container = document.getElementById("root");
            if (!container) {
                console.error("Root container not found!");
                document.body.innerHTML = '<div style="padding: 20px; text-align: center;"><h1>Error: Root container not found</h1><p>Please check the HTML structure.</p></div>';
            } else {
                const root = ReactDOM.createRoot(container);
                root.render(<App />);
            }
        } catch (error) {
            console.error("React rendering error:", error);
            document.body.innerHTML = '<div style="padding: 20px; text-align: center;"><h1>Error Loading App</h1><p>Please check the console for details.</p></div>';
        }
    </script>
</body>
</html> 